<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>100 Days of Python – Coding Notebook (Single File)</title>
<style>
  *{box-sizing:border-box}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;margin:0;background:#0b0f14;color:#e6edf3}
  header{padding:16px 20px;border-bottom:1px solid #1f2a37;background:#0f1621}
  h1{margin:0 0 8px 0;font-size:20px}
  .actions{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  button,.import-label{background:#1f6feb;color:#fff;border:none;border-radius:10px;padding:10px 14px;font-weight:600;cursor:pointer}
  button:hover,.import-label:hover{filter:brightness(1.05)}
  .import-label{display:inline-flex;align-items:center;gap:8px}
  .import-label input{display:none}
  #progress{position:relative;height:14px;background:#111826;border:1px solid #223047;border-radius:999px;overflow:hidden;margin:8px 0 6px}
  #bar{height:100%;width:0;background:#34d399;transition:width .3s}
  #progress-text{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:12px;color:#cbd5e1}
  #pledgeBadge{margin-top:6px;font-size:12px;color:#9fb3c8}
  main{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  .grid{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;align-content:start;height:calc(100dvh - 220px);overflow:auto;padding-right:8px}
  .grid button{padding:10px;border-radius:10px;background:#111826;border:1px solid #223047;color:#9fb3c8;font-weight:700}
  .grid button.active{background:#1f6feb;color:#fff;border-color:#1f6feb}
  .grid button.done{background:#14532d;border-color:#065f46;color:#fff}
  .form{background:#0f1621;border:1px solid #1f2a37;border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:10px}
  .form h2{margin:0 0 6px 0}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  label{display:flex;flex-direction:column;gap:6px;font-size:14px;color:#cbd5e1}
  input,textarea{background:#0b1220;border:1px solid #223047;color:#e6edf3;border-radius:10px;padding:10px}
  textarea{min-height:90px;resize:vertical}
  .form-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  footer{padding:10px 16px;color:#94a3b8;border-top:1px solid #1f2a37}
  @media (max-width: 920px){main{grid-template-columns:1fr} .grid{grid-template-columns:repeat(8,1fr)}}
  /* Pledge modal */
  #pledgeModal{display:none;position:fixed;inset:0;background:#0008;z-index:50}
  #pledgeBox{max-width:560px;margin:10vh auto;background:#0f1621;border:1px solid #1f2a37;border-radius:14px;padding:16px}
  #pledgeBox h3{margin:0 0 8px 0}
  #pledgeBox .btns{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}
</style>
</head>
<body>
<header>
  <h1>100 Days of Python – Coding Notebook</h1>
  <div id="progress"><div id="bar"></div><span id="progress-text">0/100</span></div>
  <div class="actions">
    <button id="exportBtn">Exportar JSON</button>
    <label class="import-label">Importar JSON
      <input type="file" id="importInput" accept="application/json">
    </label>
    <button id="resetBtn">Resetar (somente formulário atual)</button>
  </div>
  <div id="pledgeBadge"></div>
</header>

<main>
  <aside class="grid" id="dayGrid"></aside>

  <section class="form">
    <h2 id="formTitle">Dia 1</h2>
    <div class="row">
      <label><input type="checkbox" id="completed"> Concluído</label>
      <label>Data <input type="date" id="date"></label>
      <label>Minutos <input type="number" id="minutes" min="0" step="5"></label>
    </div>

    <label>Filename
      <input id="filename" placeholder="ex.: day01_hello.py">
    </label>

    <label>Concept
      <input id="concept" placeholder="ex.: variáveis, laços, funções">
    </label>

    <label>Summary / Lecture
      <textarea id="summary" placeholder="Resumo do que estudou / aula seguida"></textarea>
      <input id="lecture" placeholder="Link ou referência da aula (opcional)">
    </label>

    <label>Comments
      <textarea id="comments" placeholder="Observações, dificuldades, ideias para projetos..."></textarea>
    </label>

    <label>Topic (campo livre)
      <input id="topic" placeholder="Tema do dia">
    </label>

    <label>Notes (campo livre)
      <textarea id="notes" placeholder="Notas rápidas"></textarea>
    </label>

    <div class="form-actions">
      <button id="saveBtn">Salvar</button>
      <button id="todayBtn">Marcar data de hoje</button>
      <button id="uncheckBtn">Desmarcar concluído</button>
    </div>
  </section>
</main>

<footer>
  <p>Dados salvos automaticamente no seu navegador (localStorage). Você pode exportar/importar JSON quando quiser.</p>
</footer>

<!-- Pledge (juramento) opcional -->
<div id="pledgeModal">
  <div id="pledgeBox">
    <h3>100 Days of Python – Pledge</h3>
    <p>Eu me comprometo a estudar Python por 100 dias (1h/dia).</p>
    <label>Seu nome
      <input id="pledgeName" placeholder="Seu nome">
    </label>
    <div class="btns">
      <button id="pledgeCancel">Agora não</button>
      <button id="pledgeAccept">Assinar compromisso</button>
    </div>
  </div>
</div>

<script>
/* ====== JS ====== */
const TOTAL = 100;
const KEY = "py100_notebook_v2";

const templateDay = d => ({
  day: d, completed: false, date: null, minutes: 0,
  topic: "", notes: "", filename: "", concept: "",
  summary: "", lecture: "", comments: ""
});

function freshData(){
  return {
    meta: { title: "100 Days of Python", started: new Date().toISOString().slice(0,10), version: 2 },
    pledge_name: "", pledge_date: null, pledge_signed: false,
    days: Array.from({length: TOTAL}, (_,i)=>templateDay(i+1))
  };
}

function load() {
  const raw = localStorage.getItem(KEY);
  if (!raw) return freshData();
  try {
    const data = JSON.parse(raw);
    if (!data.meta) data.meta = { title: "100 Days of Python", started: new Date().toISOString().slice(0,10), version: 2 };
    if (!("pledge_signed" in data)) { data.pledge_name=""; data.pledge_date=null; data.pledge_signed=false; }
    data.days = (data.days || []).map((d,i)=>({ ...templateDay(i+1), ...d }));
    if (data.days.length !== TOTAL) data.days = freshData().days; // garante 100
    return data;
  } catch {
    return freshData();
  }
}

function save(data) {
  localStorage.setItem(KEY, JSON.stringify(data));
}

const state = load();
let current = 1;

const grid = document.getElementById("dayGrid");
const bar = document.getElementById("bar");
const ptxt = document.getElementById("progress-text");

// cria botões 01..100
for (let d=1; d<=TOTAL; d++){
  const btn = document.createElement("button");
  btn.textContent = String(d).padStart(2,"0");
  btn.dataset.day = d;
  btn.addEventListener("click", () => selectDay(d));
  grid.appendChild(btn);
}

function refreshGrid() {
  const done = state.days.filter(d=>d.completed).length;
  bar.style.width = `${(done/TOTAL)*100}%`;
  ptxt.textContent = `${done}/${TOTAL}`;
  document.querySelectorAll(".grid button").forEach(b=>{
    const d = state.days[parseInt(b.dataset.day)-1];
    b.classList.toggle("active", parseInt(b.dataset.day) === current);
    b.classList.toggle("done", d.completed);
  });
}

function fillForm(d) {
  document.getElementById("formTitle").textContent = `Dia ${d.day}`;
  document.getElementById("completed").checked = !!d.completed;
  document.getElementById("date").value = d.date || "";
  document.getElementById("minutes").value = d.minutes || 0;
  document.getElementById("filename").value = d.filename || "";
  document.getElementById("concept").value = d.concept || "";
  document.getElementById("summary").value = d.summary || "";
  document.getElementById("lecture").value = d.lecture || "";
  document.getElementById("comments").value = d.comments || "";
  document.getElementById("topic").value = d.topic || "";
  document.getElementById("notes").value = d.notes || "";
}

function readForm() {
  return {
    completed: document.getElementById("completed").checked,
    date: document.getElementById("date").value || null,
    minutes: parseInt(document.getElementById("minutes").value || "0"),
    filename: document.getElementById("filename").value.trim(),
    concept: document.getElementById("concept").value.trim(),
    summary: document.getElementById("summary").value.trim(),
    lecture: document.getElementById("lecture").value.trim(),
    comments: document.getElementById("comments").value.trim(),
    topic: document.getElementById("topic").value.trim(),
    notes: document.getElementById("notes").value.trim(),
  };
}

function selectDay(n) {
  current = n;
  const d = state.days[n-1];
  fillForm(d);
  refreshGrid();
}

// botões
document.getElementById("saveBtn").addEventListener("click", () => {
  const d = state.days[current-1];
  Object.assign(d, readForm());
  save(state);
  refreshGrid();
});

document.getElementById("todayBtn").addEventListener("click", () => {
  document.getElementById("date").value = new Date().toISOString().slice(0,10);
});

document.getElementById("uncheckBtn").addEventListener("click", () => {
  document.getElementById("completed").checked = false;
});

document.getElementById("exportBtn").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(state, null, 2)], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "100_days_data.json";
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById("importInput").addEventListener("change", (e) => {
  const file = e.target.files[0]; if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const data = JSON.parse(reader.result);
      if (!data.days || !Array.isArray(data.days)) throw new Error("JSON inválido");
      localStorage.setItem(KEY, JSON.stringify(data));
      Object.assign(state, load());
      selectDay(current);
      refreshGrid();
      alert("Importado com sucesso.");
    } catch (err) {
      alert("Falha ao importar JSON: " + err.message);
    }
  };
  reader.readAsText(file);
});

document.getElementById("resetBtn").addEventListener("click", () => {
  if (!confirm("Resetar somente o formulário do dia atual?")) return;
  const d = state.days[current-1];
  Object.assign(d, templateDay(current));
  save(state);
  fillForm(d);
  refreshGrid();
});

// pledge
function renderPledgeBadge(){
  const badge = document.getElementById("pledgeBadge");
  if (state.pledge_signed){
    badge.innerHTML = `✔ Compromisso assinado por <strong>${state.pledge_name}</strong> em ${state.pledge_date}.`;
  } else {
    badge.textContent = "";
  }
}
function showPledgeIfNeeded(){
  if (state.pledge_signed) return;
  const modal = document.getElementById("pledgeModal");
  const nameInput = document.getElementById("pledgeName");
  const cancelBtn = document.getElementById("pledgeCancel");
  const acceptBtn = document.getElementById("pledgeAccept");
  modal.style.display = "block";
  cancelBtn.onclick = () => modal.style.display = "none";
  acceptBtn.onclick = () => {
    const name = (nameInput.value || "").trim();
    if (!name) { alert("Digite seu nome para assinar."); return; }
    state.pledge_name = name;
    state.pledge_date = new Date().toISOString().slice(0,10);
    state.pledge_signed = true;
    save(state);
    modal.style.display = "none";
    renderPledgeBadge();
  };
}

// init
selectDay(1);
refreshGrid();
renderPledgeBadge();
showPledgeIfNeeded();
</script>
</body>
</html>
